<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shops and Menus</title>
    <style>
        /* General Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        body {
            background: #000000;
            background: linear-gradient(to right, #000000, #130F40);
            background-size: cover;
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow: hidden;
        }

        h1 {
            margin-bottom: 30px;
            color: #ffffff;
            text-align: center;
        }

        /* Shop Listing Styles */
        .shop-list {
            width: 80%;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            overflow-y: hidden;
        }

        .shop {
            margin-bottom: 20px;
            width: 300px; /* Set a fixed width for shops */
        }

        /* Button-like Shop Name Styles */
        .shop-name {
            font-size: 1.2em;
            cursor: pointer;
            color: #ffffff;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            border-radius: 50px; /* Rounded button */
            border: 2px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
            white-space: normal; /* Text wrapping */
            word-wrap: break-word;
        }

        .shop-name:hover {
            transform: translateY(-5px);
            background-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5);
        }

        /* Menu Styles */
        .menu {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            width: 100%;
            height: 200px; /* Fixed height for the menu */
            overflow-y: auto; /* Enable vertical scrolling */
            transition: max-height 0.5s ease; /* Smooth height transition */
        }

        .menu-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            justify-content: space-between; /* Spread out the contents */
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* Smooth transition for hover */
        }

        .menu-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .menu-item span {
            color: #ffffff;
            margin-left: 10px; /* Space between checkbox and item name */
        }

        .menu-item-price {
            color: #FF9900;
            margin-left: 10px; /* Space between item name and price */
        }

        .menu-item input[type="checkbox"] {
            transform: scale(1.5);
            cursor: pointer;
            margin-right: 10px; /* Space between checkbox and item name */
        }

        .menu-item input[type="number"] {
            width: 50px;
            padding: 5px;
            font-size: 14px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1); /* Match the theme */
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            border-radius: 5px;
            margin-left: 10px;
            display: none; /* Initially hide the quantity input */
        }

        .menu-item input[type="checkbox"]:checked + span + .menu-item-price + input[type="number"] {
            display: inline-block; /* Show when checkbox is checked */
        }

        /* Bag and Purchase Button */
        #purchase {
            margin-top: 20px;
            padding: 10px 16px;
            background-color: #FF0066; /* Updated purchase button color */
            border: none;
            color: white;
            font-size: 16px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Add shadow for depth */
        }

        #purchase:hover {
            background-color: #FF3399;
            transform: translateY(-2px);
        }

        /* Bag List Styling */
        .bag-list {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            width: 60%;
            max-height: 250px; /* Limit bag height */
            overflow-y: auto; /* Enable scrolling for the bag */
        }

        .total-price {
            font-weight: bold;
            color: #FF9900;
        }
    </style>
</head>
<body>

    <h1>Shops and Menus</h1>

    <div class="shop-list" id="shop-list"></div>

    <div class="bag-list">
        <h3>Your Bag</h3>
        <ul id="bag-items"></ul>
        <div class="total-price" id="total-price">Total: $0.00</div>
        <button id="purchase" onclick="purchaseItems()">Purchase</button>
    </div>

    <script>
        let bagItems = [];
        let totalPrice = 0;

        // Fetch shops and menus from the API
        async function fetchShops() {
            const response = await fetch('/api/shops');
            const shops = await response.json();
            console.log(shops);
            displayShops(shops);
        }

        function displayShops(shops) {
            const shopList = document.getElementById("shop-list");
            shopList.innerHTML = ""; // Clear existing shops

            shops.forEach(shop => {
                const shopDiv = document.createElement("div");
                shopDiv.className = "shop";

                const shopNameDiv = document.createElement("div");
                shopNameDiv.className = "shop-name";
                shopNameDiv.textContent = shop.name;
                shopNameDiv.onclick = () => toggleMenu(shop.name); // Set click event

                const menuDiv = document.createElement("div");
                menuDiv.className = "menu";
                menuDiv.id = shop.name;

                shop.items.forEach(MenuItem => {  // Changed variable name to MenuItem
                    const menuItemDiv = document.createElement("div");
                    menuItemDiv.className = "menu-item";

                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.onchange = () => checkItem(checkbox, MenuItem.name, MenuItem.amount_left);  // Updated here

                    const span = document.createElement("span");
                    span.textContent = `${MenuItem.name} (${MenuItem.amount_left} left)`;  // Updated here

                    const priceSpan = document.createElement("span");
                    priceSpan.className = "menu-item-price";
                    priceSpan.textContent = `$${MenuItem.price.toFixed(2)}`;  // Updated here

                    const quantityInput = document.createElement("input");
                    quantityInput.type = "number";
                    quantityInput.min = 1;
                    quantityInput.max = MenuItem.amount_left;  // Updated here
                    quantityInput.value = 1;
                    quantityInput.dataset.price = MenuItem.price;  // Updated here
                    quantityInput.onchange = () => updateBag(quantityInput, MenuItem.name, MenuItem.amount_left);  // Updated here
                    quantityInput.style.display = "none"; // Hide initially

                    menuItemDiv.appendChild(checkbox);
                    menuItemDiv.appendChild(span);
                    menuItemDiv.appendChild(priceSpan);
                    menuItemDiv.appendChild(quantityInput);
                    menuDiv.appendChild(menuItemDiv);
                });

                shopDiv.appendChild(shopNameDiv);
                shopDiv.appendChild(menuDiv);
                shopList.appendChild(shopDiv);
            });
        }

        function toggleMenu(menuId) {
            const menu = document.getElementById(menuId);
            menu.style.display = menu.style.display === "block" ? "none" : "block";
        }

        function checkItem(checkbox, MenuItemName, stock) {  // Updated parameter name to MenuItemName
            const inputElement = checkbox.nextElementSibling.nextElementSibling.nextElementSibling; // Get the quantity input

            if (checkbox.checked) {
                inputElement.value = 1; // Set default to 1
                inputElement.style.display = "inline-block"; // Show quantity input
                updateBag(inputElement, MenuItemName, stock); // Add to bag
            } else {
                inputElement.style.display = "none"; // Hide quantity input
                removeFromBag(MenuItemName); // Remove from bag
            }
        }

        function updateBag(inputElement, MenuItemName, stock) {  // Updated parameter name to MenuItemName
            const quantity = parseInt(inputElement.value);
            const price = parseFloat(inputElement.dataset.price);

            // Check if item is already in the bag
            const existingItemIndex = bagItems.findIndex(item => item.name === MenuItemName);  // Updated here

            if (existingItemIndex !== -1) {
                // Update quantity if the item is already in the bag
                bagItems[existingItemIndex].quantity = quantity;
                if (quantity === 0) {
                    removeFromBag(MenuItemName); // Remove if quantity is 0
                }
            } else {
                // Add new item if not already in the bag
                bagItems.push({ name: MenuItemName, price: price, quantity: quantity });  // Updated here
            }

            updateTotalPrice();
            displayBagItems();
        }

        function removeFromBag(MenuItemName) {  // Updated parameter name to MenuItemName
            bagItems = bagItems.filter(item => item.name !== MenuItemName);  // Updated here
            updateTotalPrice();
            displayBagItems();
        }

        function displayBagItems() {
            const bagList = document.getElementById("bag-items");
            bagList.innerHTML = ""; // Clear existing items

            bagItems.forEach(item => {
                const li = document.createElement("li");
                li.textContent = `${item.quantity} x ${item.name} - $${(item.price * item.quantity).toFixed(2)}`;
                bagList.appendChild(li);
            });

            const totalPriceElement = document.getElementById("total-price");
            totalPriceElement.textContent = `Total: $${totalPrice.toFixed(2)}`;
        }

        function updateTotalPrice() {
            totalPrice = bagItems.reduce((acc, item) => acc + (item.price * item.quantity), 0);
        }

        function purchaseItems() {
            if (bagItems.length === 0) {
                alert("Your bag is empty.");
            } else {
                alert(`You've purchased:\n${bagItems.map(item => `${item.quantity} x ${item.name}`).join('\n')}\nTotal: $${totalPrice.toFixed(2)}`);
                bagItems = []; // Clear the bag after purchase
                document.getElementById("bag-items").innerHTML = ""; // Clear the display
                document.getElementById("total-price").textContent = `Total: $0.00`; // Reset total price
            }
        }

        // Fetch shops when the page loads
        window.onload = fetchShops;
    </script>

</body>
</html>
